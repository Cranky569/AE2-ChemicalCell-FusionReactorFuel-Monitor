local bridge = peripheral.find("me_bridge")
local monitor = peripheral.find("monitor")

if not bridge then error("No ME-Bridge found!") end
if not monitor then error("No monitor found!") end

-- Helper function to center text on the monitor
local function centerText(mon, text, line)
    local w, _ = mon.getSize()
    local x = math.floor((w - #text) / 2) + 1
    mon.setCursorPos(x, line)
    mon.write(text)
end

-- Helper function to safely get item amount
local function getItemAmount(name)
    local item = bridge.getItem(name)
    return (item and item.amount) or 0
end

-- Helper function to format large numbers
local function formatAmount(amount)
    if amount >= 1000000 then
        return string.format("%.2f M", amount / 1000000)
    elseif amount >= 1000 then
        return string.format("%.2f k", amount / 1000)
    else
        return tostring(amount)
    end
end

-- List of chemicals
local chemicals = {
    "mekanismgenerators:tritium",
    "mekanismgenerators:deuterium",
    "mekanismgenerators:fusion_fuel"
}

local function displayMonitor()
    monitor.clear()
    local line = 1

    monitor.setTextColor(colors.purple)
    centerText(monitor, "Chemical Storage", line)
    line = line + 2

    monitor.setTextColor(colors.white)
    for _, chem in ipairs(chemicals) do
        local amt = getItemAmount(chem)
        monitor.setCursorPos(1, line)
        monitor.write(string.format("%s: %s mB", chem, formatAmount(amt)))
        line = line + 1
    end
end

-- Main loop
while true do
    displayMonitor()
    sleep(5)
end
